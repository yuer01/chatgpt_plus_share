(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages_plugs-system-role-list"],{"0ad5":function(e,t,n){"use strict";var a;n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("99af"),n("a434"),n("c975");var o=uni.vk,i={props:{value:{Type:Object,default:function(){return{show:!1,mode:"",item:""}}}},data:function(){return{data:{list:[],treeData:[],checkedKeys:[],nodeKey:"menu_id"},page:{title:"菜单赋予",submitText:"确定",cancelText:"关闭",showCancel:!0,top:"7vh",width:"800px",loading:!1},form1:{data:{role_id:"",reset:!0,menuList:[],addPermission:!0},props:{action:"admin/system/role/sys/bindMenu",columns:[{key:"addPermission",title:"同时赋予菜单内置权限",type:"switch"},{key:"menuList",title:"菜单列表",type:"text",showLabel:!1}],rules:{},labelWidth:"160px",beforeAction:function(e){for(var t=a.$refs.tree.getCheckedKeys(),n=a.$refs.tree.getHalfCheckedKeys(),i=t.concat(n),r=0;r<i.length;r++)o.pubfn.isNull(i[r])&&(i.splice(r,1),r--);return e.menuList=i,e}}}}},mounted:function(){a=this,a.init()},methods:{init:function(){var e=a,t=e.value;a.$emit("input",t)},onOpen:function(){a=this;var e=a,t=e.value,n=void 0===t?{}:t,i=n.item,r=i.role_id,l=i.role_name,s=i.menu,c=void 0===s?[]:s;a.page.title="菜单赋予（".concat(l,"）"),a.form1.data.role_id=r,a.form1.data.menuList=c,o.pubfn.isNotNull(a.data.treeData)?a.initData():a.getList()},getList:function(){o.callFunction({url:"admin/system/menu/sys/getAll",loading:{that:a,name:"page.loading"},data:{},success:function(e){var t=[{label:"全选",menu_id:"",children:e.rows}];a.data.treeData=t,a.data.list=e.list,a.initData()}})},initData:function(){var e=a,t=e.value,n=void 0===t?{}:t,i=n.item,r=(i.role_id,i.role_name,i.menu),l=void 0===r?[]:r,s=o.pubfn.copyObject(l);for(var c in a.data.list){var u=a.data.list[c],d=s.indexOf(u.parent_id);d>-1&&s.splice(d,1)}a.data.checkedKeys=s,a.$refs.tree.setCheckedKeys(s)},onClose:function(){a.$refs.form1.resetForm()},onFormSuccess:function(e){e.data.info&&(a.$set(a.value.item,"menu",e.data.info.menu),a.$set(a.value.item,"stats_count_info",e.data.info.stats_count_info)),a.value.show=!1,a.$emit("success")}},watch:{},computed:{}};t.default=i},"45a6":function(e,t,n){"use strict";n.r(t);var a=n("c756"),o=n("ec5e");for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var r=n("f0c5"),l=Object(r["a"])(o["default"],a["b"],a["c"],!1,null,"88179614",null,!1,a["a"],void 0);t["default"]=l.exports},4623:function(e,t,n){"use strict";n("7a82");var a=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("3835")),i=a(n("b85c"));n("d81d"),n("d3b7"),n("ddb0"),n("99af");var r,l=a(n("a28c")),s=a(n("45a6")),c=uni.vk,u={},d={components:{bindPermission:l.default,bindMenu:s.default},data:function(){return{loading:!1,data:{},table1:{action:"admin/system/role/sys/getList",columns:[{key:"role_id",title:"角色标识",type:"text",width:220},{key:"role_name",title:"角色名称",type:"text",width:130},{key:"comment",title:"备注",type:"text",minWidth:180},{key:"permissionList",title:"拥有的权限",type:"text",minWidth:290,align:"left",formatter:function(e,t,n,a){var o="";return"admin"===t.role_id?o="系统内置角色 - 拥有所有权限":c.pubfn.isNull(e)?o="该角色未赋予任何权限":e.map((function(t,n){c.pubfn.isNotNull(t.url)&&(o+=t.permission_name,n!==e.length-1&&(o+="、"))})),o}},{key:"menuList",title:"拥有的菜单",type:"text",minWidth:290,align:"left",formatter:function(e,t,n,a){var o="";return"admin"===t.role_id?o="系统内置角色 - 拥有所有菜单":c.pubfn.isNull(e)?o="该角色未赋予任何菜单":e.map((function(t,n){o+=t.name,n!==e.length-1&&(o+="、")})),o}},{key:"stats_count_info",title:"统计信息",type:"html",width:220,align:"left",show:["detail"],formatter:function(e,t,n,a){console.log("val",e);var r="";if("admin"===t.role_id)return"拥有所有权限";for(var l in e){switch(l){case"curd_category":r+="分类:&nbsp;&nbsp;";break;case"level":r+="等级:&nbsp;&nbsp;";break;case"match_mode":r+="模式:&nbsp;&nbsp;";break;default:r+="菜单和权限:&nbsp;&nbsp;";break}var s,c=(0,i.default)(e[l].entries());try{for(c.s();!(s=c.n()).done;){var u=(0,o.default)(s.value,2),d=(u[0],u[1]);r+="".concat(d.label," : ").concat(d.count,"个&nbsp;&nbsp;")}}catch(f){c.e(f)}finally{c.f()}r+="<br/>"}return r}},{key:"enable",title:"是否启用",type:"tag",data:[{value:!0,label:"启用",tagType:"success"},{value:!1,label:"禁用",tagType:"danger"}]}],multipleSelection:[],selectItem:""},queryForm1:{formData:{},columns:[{key:"role_id",title:"角色标识",type:"text",width:160,mode:"%%"},{key:"role_name",title:"角色名称",type:"text",width:160,mode:"%%"},{key:"_add_time",title:"添加时间",type:"datetimerange",width:400}]},form1:{data:{enable:!0},props:{action:"",columns:[{key:"role_id",title:"角色标识",type:"text",show:["add"]},{key:"role_name",title:"角色名称",type:"text"},{key:"comment",title:"备注",type:"textarea",maxlength:"99",showWordLimit:!0,autosize:{minRows:2,maxRows:10}},{key:"enable",title:"是否启用",type:"switch"}],rules:{role_id:[{required:!0,message:"角色标识不能为空",trigger:"blur"}],role_name:[{required:!0,message:"角色名称不能为空",trigger:"change"}]},formType:"",show:!1}},formDatas:{}}},onLoad:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r=this,c=r.vk,r.options=e,r.init(e)},onReady:function(){},onShow:function(){},onHide:function(){},methods:{init:function(e){u["form1"]=c.pubfn.copyObject(r.form1)},pageTo:function(e){c.navigateTo(e)},resetForm:function(){c.pubfn.resetForm(u,r)},search:function(){r.$refs.table1.query()},refresh:function(){r.$refs.table1.refresh()},getCurrentRow:function(e){return r.$refs.table1.getCurrentRow(e)},currentChange:function(e){r.table1.selectItem=e},selectionChange:function(e){r.table1.multipleSelection=e},addBtn:function(){r.resetForm(),r.form1.props.action="admin/system/role/sys/add",r.form1.props.formType="add",r.form1.props.title="添加",r.form1.props.show=!0},updateBtn:function(e){var t=e.item;r.form1.props.action="admin/system/role/sys/update",r.form1.props.formType="update",r.form1.props.title="编辑",r.form1.props.show=!0,r.form1.data=t},deleteBtn:function(e){var t=e.item,n=e.deleteFn;n({action:"admin/system/role/sys/delete",data:{role_id:t.role_id}})},bindPermissionBtn:function(){var e=r.getCurrentRow(!0);c.pubfn.openForm("bindPermission",{item:e})},bindMenu:function(){var e=r.getCurrentRow(!0);c.pubfn.openForm("bindMenu",{item:e})}},watch:{},computed:{}};t.default=d},4805:function(e,t,n){"use strict";var a=n("9183"),o=n.n(a);o.a},"74fc":function(e,t,n){"use strict";n.r(t);var a=n("4623"),o=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a},9183:function(e,t,n){var a=n("fc24");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=n("4f06").default;o("66372c76",a,!0,{sourceMap:!1,shadowMode:!1})},a28c:function(e,t,n){"use strict";n.r(t);var a=n("fe80"),o=n("c548");for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var r=n("f0c5"),l=Object(r["a"])(o["default"],a["b"],a["c"],!1,null,"ae5994c0",null,!1,a["a"],void 0);t["default"]=l.exports},a68a:function(e,t,n){"use strict";n.r(t);var a=n("c3e2"),o=n("74fc");for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);n("4805");var r=n("f0c5"),l=Object(r["a"])(o["default"],a["b"],a["c"],!1,null,"fdb5f1c0",null,!1,a["a"],void 0);t["default"]=l.exports},c3e2:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"page-body"},[n("vk-data-table-query",{attrs:{columns:e.queryForm1.columns},on:{search:function(t){arguments[0]=t=e.$handleEvent(t),e.search.apply(void 0,arguments)}},model:{value:e.queryForm1.formData,callback:function(t){e.$set(e.queryForm1,"formData",t)},expression:"queryForm1.formData"}}),n("v-uni-view",{staticClass:"vk-table-button-box"},[n("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-circle-plus-outline"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.addBtn.apply(void 0,arguments)}}},[e._v("添加")]),n("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-s-tools",disabled:!e.table1.selectItem},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.bindPermissionBtn.apply(void 0,arguments)}}},[e._v("权限赋予")]),n("el-button",{attrs:{type:"danger",size:"small",icon:"el-icon-s-tools",disabled:!e.table1.selectItem},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.bindMenu.apply(void 0,arguments)}}},[e._v("菜单赋予")])],1),n("vk-data-table",{ref:"table1",attrs:{action:e.table1.action,columns:e.table1.columns,"query-form-param":e.queryForm1,"right-btns":["detail_auto","update","delete"],selection:!1,"row-no":!0,pagination:!0},on:{update:function(t){arguments[0]=t=e.$handleEvent(t),e.updateBtn.apply(void 0,arguments)},delete:function(t){arguments[0]=t=e.$handleEvent(t),e.deleteBtn.apply(void 0,arguments)},"current-change":function(t){arguments[0]=t=e.$handleEvent(t),e.currentChange.apply(void 0,arguments)},"selection-change":function(t){arguments[0]=t=e.$handleEvent(t),e.selectionChange.apply(void 0,arguments)}}}),n("vk-data-dialog",{attrs:{title:e.form1.props.title,width:"500px",mode:"form"},model:{value:e.form1.props.show,callback:function(t){e.$set(e.form1.props,"show",t)},expression:"form1.props.show"}},[n("vk-data-form",{attrs:{rules:e.form1.props.rules,action:e.form1.props.action,"form-type":e.form1.props.formType,columns:e.form1.props.columns,"label-width":"80px"},on:{success:function(t){arguments[0]=t=e.$handleEvent(t),e.form1.props.show=!1,e.refresh()}},model:{value:e.form1.data,callback:function(t){e.$set(e.form1,"data",t)},expression:"form1.data"}})],1),n("bindPermission",{model:{value:e.formDatas.bindPermission,callback:function(t){e.$set(e.formDatas,"bindPermission",t)},expression:"formDatas.bindPermission"}}),n("bindMenu",{model:{value:e.formDatas.bindMenu,callback:function(t){e.$set(e.formDatas,"bindMenu",t)},expression:"formDatas.bindMenu"}})],1)},o=[]},c548:function(e,t,n){"use strict";n.r(t);var a=n("f319"),o=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a},c756:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("vk-data-dialog",{attrs:{title:e.page.title,top:e.page.top,width:e.page.width,mode:"form"},on:{open:function(t){arguments[0]=t=e.$handleEvent(t),e.onOpen.apply(void 0,arguments)},closed:function(t){arguments[0]=t=e.$handleEvent(t),e.onClose.apply(void 0,arguments)}},model:{value:e.value.show,callback:function(t){e.$set(e.value,"show",t)},expression:"value.show"}},[n("vk-data-form",{directives:[{name:"loading",rawName:"v-loading",value:e.page.loading,expression:"page.loading"}],ref:"form1",attrs:{"form-type":e.value.mode,rules:e.form1.props.rules,action:e.form1.props.action,columns:e.form1.props.columns,loading:e.form1.props.loading,labelWidth:e.form1.props.labelWidth,"before-action":e.form1.props.beforeAction,"show-cancel":e.page.showCancel,"cancel-text":e.page.cancelText,"submit-text":e.page.submitText},on:{"update:loading":function(t){arguments[0]=t=e.$handleEvent(t),e.$set(e.form1.props,"loading",t)},success:function(t){arguments[0]=t=e.$handleEvent(t),e.onFormSuccess.apply(void 0,arguments)}},scopedSlots:e._u([{key:"menuList",fn:function(){return[n("el-tree",{ref:"tree",attrs:{data:e.data.treeData,"node-key":e.data.nodeKey,"default-checked-keys":e.data.checkedKeys,props:{children:"children",label:"label"},"show-checkbox":!0,"default-expand-all":!0,"expand-on-click-node":!0}})]},proxy:!0}]),model:{value:e.form1.data,callback:function(t){e.$set(e.form1,"data",t)},expression:"form1.data"}})],1)},o=[]},ec5e:function(e,t,n){"use strict";n.r(t);var a=n("0ad5"),o=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a},f319:function(e,t,n){"use strict";var a;n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("99af"),n("a434"),n("d3b7"),n("159b"),n("c975");var o=uni.vk,i={props:{value:{Type:Object,default:function(){return{show:!1,mode:"",item:""}}}},data:function(){return{data:{list:[],info:{},treeData:[],checkedKeys:[],nodeKey:"permission_id"},page:{title:"权限赋予",submitText:"确定",cancelText:"关闭",showCancel:!0,top:"7vh",width:"800px",loading:!1},form1:{data:{role_id:"",reset:!0,permissionList:[],stats_count_info:{}},props:{action:"admin/system/role/sys/bindPermission",columns:[{key:"permissionList",title:"权限列表",type:"text"}],rules:{},labelWidth:"100px",beforeAction:function(e){for(var t=a.$refs.tree.getCheckedKeys(),n=a.$refs.tree.getHalfCheckedKeys(),i=t.concat(n),r=0;r<i.length;r++)o.pubfn.isNull(i[r])&&(i.splice(r,1),r--);e.permissionList=i;var l=o.pubfn.getData(a.data,"info.stats_count_info.type[0].count",0);"number"!==typeof l&&(l=0);var s=o.pubfn.treeToArray(a.data.treeData,{id:"permission_id",parent_id:"parent_id",children:"children",deleteChildren:!0}),c={curd_category:[{type:0,label:"未分类",count:0},{type:1,label:"增",count:0},{type:2,label:"删",count:0},{type:3,label:"改",count:0},{type:4,label:"查",count:0},{type:5,label:"特殊",count:0}],level:[{type:0,label:"未分类",count:0},{type:1,label:"子弹级",count:0},{type:2,label:"炸弹级",count:0},{type:3,label:"榴弹级",count:0},{type:4,label:"核弹级",count:0}],match_mode:[{type:0,label:"完整路径",count:0},{type:1,label:"通配符",count:0},{type:2,label:"正则表达式",count:0}],type:[{type:0,label:"菜单",count:l},{type:1,label:"权限",count:0}]};return i.forEach((function(e,t,n){var a=o.pubfn.getListItem(s,"permission_id",e),i=a.curd_category,r=void 0===i?0:i,l=a.level,u=void 0===l?0:l,d=a.match_mode,f=void 0===d?0:d,p=a.url;o.pubfn.isNotNull(p)&&(c["type"][1].count++,c["curd_category"][r].count++,c["level"][u].count++,c["match_mode"][f].count++)})),e.stats_count_info=c,e}}}}},mounted:function(){a=this,a.init()},methods:{init:function(){var e=a,t=e.value;a.$emit("input",t)},onOpen:function(){a=this;var e=a,t=e.value,n=void 0===t?{}:t,i=n.item,r=i.role_id,l=i.role_name,s=i.permission,c=void 0===s?[]:s;a.page.title="权限赋予（".concat(l,"）"),a.data.info=i,a.form1.data.role_id=r,a.form1.data.permissionList=c,o.pubfn.isNotNull(a.data.treeData)?a.initData():a.getList()},getList:function(){o.callFunction({url:"admin/system/permission/sys/getAll",data:{},loading:{that:a,name:"page.loading"},success:function(e){var t=[{label:"全选",permission_id:"",children:e.rows}];a.data.treeData=t,a.data.list=e.list,a.initData()}})},initData:function(){var e=a,t=e.value,n=void 0===t?{}:t,i=n.item,r=(i.menu_id,i.name,i.permission),l=void 0===r?[]:r,s=o.pubfn.copyObject(l);for(var c in a.data.list){var u=a.data.list[c],d=s.indexOf(u.parent_id);d>-1&&s.splice(d,1)}a.data.checkedKeys=s,a.$refs.tree.setCheckedKeys(s)},onClose:function(){a.$refs.form1.resetForm()},onFormSuccess:function(e){e.data.info&&(a.$set(a.value.item,"permission",e.data.info.permission),a.$set(a.value.item,"stats_count_info",e.data.info.stats_count_info)),a.value.show=!1,a.$emit("success")}},watch:{},computed:{}};t.default=i},fc24:function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,"[data-v-fdb5f1c0] .el-tree-node__content .el-checkbox{margin-right:8px}",""]),e.exports=t},fe80:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("vk-data-dialog",{attrs:{title:e.page.title,top:e.page.top,width:e.page.width,mode:"form"},on:{open:function(t){arguments[0]=t=e.$handleEvent(t),e.onOpen.apply(void 0,arguments)},closed:function(t){arguments[0]=t=e.$handleEvent(t),e.onClose.apply(void 0,arguments)}},model:{value:e.value.show,callback:function(t){e.$set(e.value,"show",t)},expression:"value.show"}},[n("vk-data-form",{directives:[{name:"loading",rawName:"v-loading",value:e.page.loading,expression:"page.loading"}],ref:"form1",attrs:{"form-type":e.value.mode,rules:e.form1.props.rules,action:e.form1.props.action,columns:e.form1.props.columns,loading:e.form1.props.loading,labelWidth:e.form1.props.labelWidth,"before-action":e.form1.props.beforeAction,"show-cancel":e.page.showCancel,"cancel-text":e.page.cancelText,"submit-text":e.page.submitText},on:{"update:loading":function(t){arguments[0]=t=e.$handleEvent(t),e.$set(e.form1.props,"loading",t)},success:function(t){arguments[0]=t=e.$handleEvent(t),e.onFormSuccess.apply(void 0,arguments)}},scopedSlots:e._u([{key:"permissionList",fn:function(){return[n("el-tree",{ref:"tree",attrs:{data:e.data.treeData,"node-key":e.data.nodeKey,"default-checked-keys":e.data.checkedKeys,props:{children:"children",label:"label"},"show-checkbox":!0,"default-expand-all":!0,"expand-on-click-node":!0}})]},proxy:!0}]),model:{value:e.form1.data,callback:function(t){e.$set(e.form1,"data",t)},expression:"form1.data"}})],1)},o=[]}}]);